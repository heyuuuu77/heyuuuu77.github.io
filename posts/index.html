<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | heyuuuu77</title>
<meta name=keywords content><meta name=description content="Posts - heyuuuu77"><meta name=author content="Me"><link rel=canonical href=https://heyuuuu77.github.io/posts/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=stylesheet href=https://heyuuuu77.github.io/assets/css/custom.css><script src=https://heyuuuu77.github.io/assets/js/random-gradient.js></script><link rel=icon href=https://heyuuuu77.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://heyuuuu77.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://heyuuuu77.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://heyuuuu77.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://heyuuuu77.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://heyuuuu77.github.io/posts/index.xml><link rel=alternate hreflang=en href=https://heyuuuu77.github.io/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://heyuuuu77.github.io/posts/"><meta property="og:site_name" content="heyuuuu77"><meta property="og:title" content="Posts"><meta property="og:description" content="ç®€å•è®°å½•"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://heyuuuu77.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://heyuuuu77.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Posts"><meta name=twitter:description content="ç®€å•è®°å½•"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://heyuuuu77.github.io/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://heyuuuu77.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://heyuuuu77.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://heyuuuu77.github.io/categories title=categories><span>categories</span></a></li><li><a href=https://heyuuuu77.github.io/posts/ title=Posts><span class=active>Posts</span></a></li><li><a href=https://heyuuuu77.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://heyuuuu77.github.io/>Home</a></div><h1>Posts
<a href=/posts/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>æ­Œå•</h2></header><div class=entry-content><p></p></div><footer class=entry-footer><span title='2025-01-15 11:30:03 +0000 +0000'>January 15, 2025</span>&nbsp;Â·&nbsp;0 min&nbsp;Â·&nbsp;0 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to æ­Œå•" href=https://heyuuuu77.github.io/posts/music_list/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Elasticsearch</h2></header><div class=entry-content><p>start elasticsearch with docker localhost æ‰§è¡Œ
curl -fsSL https://elastic.co/start-local | sh 8DkwaOdk 8DkwaOdk elastic curl -ssSL will get start-local.sh. The content will be:
#!/bin/sh # -------------------------------------------------------- # Run Elasticsearch and Kibana for local testing # Note: do not use this script in a production environment # -------------------------------------------------------- # # Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one # or more contributor license agreements. See the NOTICE file distributed with # this work for additional information regarding copyright # ownership. Elasticsearch B.V. licenses this file to you under # the Apache License, Version 2.0 (the "License"); you may # not use this file except in compliance with the License. # You may obtain a copy of the License at # # http://www.apache.org/licenses/LICENSE-2.0 # # Unless required by applicable law or agreed to in writing, # software distributed under the License is distributed on an # "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY # KIND, either express or implied. See the License for the # specific language governing permissions and limitations # under the License. set -eu parse_args() { # Parse the script parameters while [ "$#" -gt 0 ]; do case "$1" in -v) # Check that there is another argument for the version if [ $# -lt 2 ]; then echo "Error: -v requires a version value (eg. -v 8.17.0)" exit 1 fi es_version="$2" shift 2 ;; --esonly) esonly=true shift ;; --) # End of options; shift and exit the loop shift break ;; -*) # Unknown or unsupported option echo "Error: Unknown option '$1'" exit 1 ;; *) # We've hit a non-option argument; stop parsing options break ;; esac done } startup() { echo echo ' ______ _ _ _ ' echo ' | ____| | | | (_) ' echo ' | |__ | | __ _ ___| |_ _ ___ ' echo ' | __| | |/ _` / __| __| |/ __|' echo ' | |____| | (_| \__ \ |_| | (__ ' echo ' |______|_|\__,_|___/\__|_|\___|' echo '-------------------------------------------------' echo 'ğŸš€ Run Elasticsearch and Kibana for local testing' echo '-------------------------------------------------' echo echo 'â„¹ï¸ Do not use this script in a production environment' echo # Version version="0.10.0" # Folder name for the installation installation_folder="${ES_LOCAL_DIR:-elastic-start-local}" # API key name for Elasticsearch api_key_name="elastic-start-local" # Name of the error log error_log="error-start-local.log" # Minimum version for docker-compose min_docker_compose="1.29.0" # Elasticsearch container name elasticsearch_container_name="es-local-dev${ES_LOCAL_DIR:+-${ES_LOCAL_DIR}}" # Kibana container name kibana_container_name="kibana-local-dev${ES_LOCAL_DIR:+-${ES_LOCAL_DIR}}" # Kibana settings container name kibana_settings_container_name="kibana-local-settings${ES_LOCAL_DIR:+-${ES_LOCAL_DIR}}" # Minimum disk space required for docker images + services (in GB) min_disk_space_required=5 } # Check for ARM64 architecture is_arm64() { arch="$(uname -m)" if [ "$arch" = "arm64" ] || [ "$arch" = "aarch64" ]; then return 0 # Return 0 (true) else return 1 # Return 1 (false) fi } # Alternative to sort -V, which is not available in BSD-based systems (e.g., macOS) version_sort() { awk -F'.' ' { printf("%d %d %d %s\n", $1, $2, $3, $0) }' | sort -n -k1,1 -k2,2 -k3,3 | awk '{print $4}' } # Function to check if the format is a valid semantic version (major.minor.patch) is_valid_version() { echo "$1" | grep -E -q '^[0-9]+\.[0-9]+\.[0-9]+$' } # Get the latest stable version of Elasticsearch # Note: It removes all the beta or candidate releases from the list # but includes the GA releases (e.g. new major) get_latest_version() { versions="$(curl -s "https://artifacts.elastic.co/releases/stack.json")" latest_version=$(echo "$versions" | awk -F'"' '/"version": *"/ {print $4}' | grep -E '^[0-9]+\.[0-9]+\.[0-9]+( GA)?$' | version_sort | tail -n 1) # Remove the GA prefix from the version, if present latest_version=$(echo "$latest_version" | awk '{ gsub(/ GA$/, "", $0); print }') # Check if the latest version is empty if [ -z "$latest_version" ]; then echo "Error: the latest Elasticsearch version is empty" exit 1 fi # Check if the latest version is valid if ! is_valid_version "$latest_version"; then echo "Error: {$latest_version} is not a valid Elasticsearch stable version" exit 1 fi echo "$latest_version" } # Detect if running on LXC container detect_lxc() { # Check /proc/1/environ for LXC container identifier if grep -qa "container=lxc" /proc/1/environ 2>/dev/null; then return 0 fi # Check /proc/self/cgroup for LXC references if grep -q "lxc" /proc/self/cgroup 2>/dev/null; then return 0 fi # Check for LXC in /sys/fs/cgroup if grep -q "lxc" /sys/fs/cgroup/* 2>/dev/null; then return 0 fi # Use systemd-detect-virt if available if command -v systemd-detect-virt >/dev/null 2>&amp;1; then if [ "$(systemd-detect-virt)" = "lxc" ]; then return 0 fi fi return 1 } # Get linux distribution get_os_info() { if [ -f /etc/os-release ]; then # Most modern Linux distributions have this file . /etc/os-release echo "Distribution: $NAME" echo "Version: $VERSION" elif [ -f /etc/lsb-release ]; then # For older distributions using LSB (Linux Standard Base) . /etc/lsb-release echo "Distribution: $DISTRIB_ID" echo "Version: $DISTRIB_RELEASE" elif [ -f /etc/debian_version ]; then # For Debian-based distributions without os-release or lsb-release echo "Distribution: Debian" echo "Version: $(cat /etc/debian_version)" elif [ -f /etc/redhat-release ]; then # For Red Hat-based distributions echo "Distribution: $(cat /etc/redhat-release)" elif [ -n "${OSTYPE+x}" ]; then if [ "${OSTYPE#darwin}" != "$OSTYPE" ]; then # macOS detection echo "Distribution: macOS" echo "Version: $(sw_vers -productVersion)" elif [ "$OSTYPE" = "cygwin" ] || [ "$OSTYPE" = "msys" ] || [ "$OSTYPE" = "win32" ]; then # Windows detection in environments like Git Bash, Cygwin, or MinGW echo "Distribution: Windows" echo "Version: $(cmd.exe /c ver | tr -d '\r')" elif [ "$OSTYPE" = "linux-gnu" ] && uname -r | grep -q "Microsoft"; then # Windows Subsystem for Linux (WSL) detection echo "Distribution: Windows (WSL)" echo "Version: $(uname -r)" fi else echo "Unknown operating system" fi if [ -f /proc/version ]; then # Check if running on WSL2 or WSL1 for Microsoft if grep -q "WSL2" /proc/version; then echo "Running on WSL2" elif grep -q "microsoft" /proc/version; then echo "Running on WSL1" fi fi } # Check if a command exists available() { command -v "$1" >/dev/null; } # Revert the status, removing containers, volumes, network and folder cleanup() { if [ -d "./../$folder_to_clean" ]; then if [ -f "docker-compose.yml" ]; then $docker_clean >/dev/null 2>&amp;1 $docker_remove_volumes >/dev/null 2>&amp;1 fi cd .. rm -rf "${folder_to_clean}" fi } # Generate the error log # parameter 1: error message # parameter 2: the container names to retrieve, separated by comma generate_error_log() { msg="$1" docker_services="$2" error_file="$error_log" if [ -d "./../$folder_to_clean" ]; then error_file="./../$error_log" fi if [ -n "${msg}" ]; then echo "${msg}" > "$error_file" fi { echo "Start-local version: ${version}" echo "Docker engine: $(docker --version)" echo "Docker compose: ${docker_version}" get_os_info } >> "$error_file" for service in $docker_services; do echo "-- Logs of service ${service}:" >> "$error_file" docker logs "${service}" >> "$error_file" 2> /dev/null done echo "An error log has been generated in ${error_log} file." echo "If you need assistance, open an issue at https://github.com/elastic/start-local/issues" } # Compare versions # parameter 1: version to compare # parameter 2: version to compare compare_versions() { v1=$1 v2=$2 original_ifs="$IFS" IFS='.' # shellcheck disable=SC2086 set -- $v1; v1_major=${1:-0}; v1_minor=${2:-0}; v1_patch=${3:-0} IFS='.' # shellcheck disable=SC2086 set -- $v2; v2_major=${1:-0}; v2_minor=${2:-0}; v2_patch=${3:-0} IFS="$original_ifs" [ "$v1_major" -lt "$v2_major" ] && echo "lt" && return 0 [ "$v1_major" -gt "$v2_major" ] && echo "gt" && return 0 [ "$v1_minor" -lt "$v2_minor" ] && echo "lt" && return 0 [ "$v1_minor" -gt "$v2_minor" ] && echo "gt" && return 0 [ "$v1_patch" -lt "$v2_patch" ] && echo "lt" && return 0 [ "$v1_patch" -gt "$v2_patch" ] && echo "gt" && return 0 echo "eq" } # Wait for availability of Kibana # parameter: timeout in seconds wait_for_kibana() { timeout="${1:-60}" echo "- Waiting for Kibana to be ready" echo start_time="$(date +%s)" until curl -s -I http://localhost:5601 | grep -q 'HTTP/1.1 302 Found'; do elapsed_time="$(($(date +%s) - start_time))" if [ "$elapsed_time" -ge "$timeout" ]; then error_msg="Error: Kibana timeout of ${timeout} sec" echo "$error_msg" generate_error_log "${error_msg}" "${elasticsearch_container_name} ${kibana_container_name} kibana-settings" cleanup exit 1 fi sleep 2 done } # Generates a random password with letters and numbers # parameter: size of the password (default is 8 characters) random_password() { LENGTH="${1:-8}" LC_ALL=C tr -dc 'A-Za-z0-9' &lt; /dev/urandom | head -c "${LENGTH}" } # Create an API key for Elasticsearch # parameter 1: the Elasticsearch password # parameter 2: name of the API key to generate create_api_key() { es_password=$1 name=$2 response="$(curl -s -u "elastic:${es_password}" -X POST http://localhost:9200/_security/api_key -d "{\"name\": \"${name}\"}" -H "Content-Type: application/json")" if [ -z "$response" ]; then echo "" else api_key="$(echo "$response" | grep -Eo '"encoded":"[A-Za-z0-9+/=]+' | grep -Eo '[A-Za-z0-9+/=]+' | tail -n 1)" echo "$api_key" fi } # Check if a container is runnning # parameter: the name of the container check_container_running() { container_name=$1 containers="$(docker ps --format '{{.Names}}')" if echo "$containers" | grep -q "^${container_name}$"; then echo "The docker container '$container_name' is already running!" echo "You can have only one running at time." echo "To stop the container run the following command:" echo echo "docker stop $container_name" exit 1 fi } # Check the available disk space in GB # parameter: required size in GB check_disk_space_gb() { required=$1 available_gb=$(($(df -k / | awk 'NR==2 {print $4}') / 1024 / 1024)) if [ "$available_gb" -lt "$required" ]; then echo "Error: only ${available_gb} GB of disk space available; ${required} GB required for the installation" exit 1 fi } check_requirements() { # Check the requirements check_disk_space_gb ${min_disk_space_required} if ! available "curl"; then echo "Error: curl command is required" echo "You can install it from https://curl.se/download.html." exit 1 fi if ! available "grep"; then echo "Error: grep command is required" echo "You can install it from https://www.gnu.org/software/grep/." exit 1 fi need_wait_for_kibana=true # Check for "docker compose" or "docker-compose" set +e if ! docker compose >/dev/null 2>&amp;1; then if ! available "docker-compose"; then if ! available "docker"; then echo "Error: docker command is required" echo "You can install it from https://docs.docker.com/engine/install/." exit 1 fi echo "Error: docker compose is required" echo "You can install it from https://docs.docker.com/compose/install/" exit 1 fi docker="docker-compose up -d" docker_stop="docker-compose stop" docker_clean="docker-compose rm -fsv" docker_remove_volumes="docker-compose down -v" docker_version=$(docker-compose --version | head -n 1 | grep -Eo '[0-9]+\.[0-9]+\.[0-9]+') if [ "$(compare_versions "$docker_version" "$min_docker_compose")" = "lt" ]; then echo "Unfortunately we don't support docker compose ${docker_version}. The minimum required version is $min_docker_compose." echo "You can migrate you docker compose from https://docs.docker.com/compose/migrate/" cleanup exit 1 fi else docker_stop="docker compose stop" docker_clean="docker compose rm -fsv" docker_remove_volumes="docker compose down -v" docker_version=$(docker compose version | head -n 1 | grep -Eo '[0-9]+\.[0-9]+\.[0-9]+') # --wait option has been introduced in 2.1.1+ if [ "$(compare_versions "$docker_version" "2.1.0")" = "gt" ]; then docker="docker compose up --wait" need_wait_for_kibana=false else docker="docker compose up -d" fi fi set -e } check_installation_folder() { # Check if $installation_folder exists folder=$installation_folder if [ -d "$folder" ]; then if [ -n "$(ls -A "$folder")" ]; then echo "It seems you have already a start-local installation in '${folder}'." if [ -f "$folder/uninstall.sh" ]; then echo "I cannot proceed unless you uninstall it, using the following command:" echo "cd $folder && ./uninstall.sh" else echo "I did not find the uninstall.sh file, you need to proceed manually." if [ -f "$folder/docker-compose.yml" ] && [ -f "$folder/.env" ]; then echo "Execute the following commands:" echo "cd $folder" echo "$docker_clean" echo "$docker_remove_volumes" echo "cd .." echo "rm -rf $folder" fi fi exit 1 fi fi } check_docker_services() { # Check for docker containers running check_container_running "$elasticsearch_container_name" check_container_running "$kibana_container_name" check_container_running "$kibana_settings_container_name" } create_installation_folder() { # If $folder already exists, it is empty, see above if [ ! -d "$folder" ]; then mkdir "$folder" fi cd "$folder" folder_to_clean=$folder } generate_passwords() { # Generate random passwords es_password="${ES_LOCAL_PASSWORD:-$(random_password)}" if [ -z "${esonly:-}" ]; then kibana_password="$(random_password)" kibana_encryption_key="$(random_password 32)" fi } choose_es_version() { if [ -z "${es_version:-}" ]; then # Get the latest Elasticsearch version es_version="$(get_latest_version)" fi # Fix for ARM64: add suffix "-arm64" if is_arm64 && [ "${es_version##*-arm64}" = "$es_version" ]; then es_version="${es_version}-arm64" fi } create_env_file() { # Create the .env file cat > .env &lt;&lt;- EOM START_LOCAL_VERSION=$version ES_LOCAL_VERSION=$es_version ES_LOCAL_CONTAINER_NAME=$elasticsearch_container_name ES_LOCAL_PASSWORD=$es_password ES_LOCAL_PORT=9200 ES_LOCAL_URL=http://localhost:\${ES_LOCAL_PORT} ES_LOCAL_HEAP_INIT=128m ES_LOCAL_HEAP_MAX=2g ES_LOCAL_DISK_SPACE_REQUIRED=1gb EOM if [ -z "${esonly:-}" ]; then cat >> .env &lt;&lt;- EOM KIBANA_LOCAL_CONTAINER_NAME=$kibana_container_name KIBANA_LOCAL_SETTINGS_CONTAINER_NAME=$kibana_settings_container_name KIBANA_LOCAL_PORT=5601 KIBANA_LOCAL_PASSWORD=$kibana_password KIBANA_ENCRYPTION_KEY=$kibana_encryption_key EOM fi } # Create the start script (start.sh) # including the license update if trial expired create_start_file() { today=$(date +%s) expire=$((today + 3600*24*30)) cat > start.sh &lt;&lt;-'EOM' #!/bin/sh # Start script for start-local # More information: https://github.com/elastic/start-local set -eu SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)" cd "${SCRIPT_DIR}" today=$(date +%s) . ./.env # Check disk space available_gb=$(($(df -k / | awk 'NR==2 {print $4}') / 1024 / 1024)) required=$(echo "${ES_LOCAL_DISK_SPACE_REQUIRED}" | grep -Eo '[0-9]+') if [ "$available_gb" -lt "$required" ]; then echo "----------------------------------------------------------------------------" echo "WARNING: Disk space is below the ${required} GB limit. Elasticsearch will be" echo "executed in read-only mode. Please free up disk space to resolve this issue." echo "----------------------------------------------------------------------------" echo "Press ENTER to confirm." # shellcheck disable=SC2034 read -r line fi EOM if [ "$need_wait_for_kibana" = true ]; then cat >> start.sh &lt;&lt;-'EOM' wait_for_kibana() { _timeout="${1:-60}" echo "- Waiting for Kibana to be ready" echo _start_time="$(date +%s)" until curl -s -I http://localhost:5601 | grep -q 'HTTP/1.1 302 Found'; do elapsed_time="$(($(date +%s) - _start_time))" if [ "$elapsed_time" -ge "$_timeout" ]; then echo "Error: Kibana timeout of ${_timeout} sec" exit 1 fi sleep 2 done } EOM fi cat >> start.sh &lt;&lt;- EOM if [ -z "\${ES_LOCAL_LICENSE:-}" ] && [ "\$today" -gt $expire ]; then echo "---------------------------------------------------------------------" echo "The one-month trial period has expired. You can continue using the" echo "Free and open Basic license or request to extend the trial for" echo "another 30 days using this form:" echo "https://www.elastic.co/trialextension" echo "---------------------------------------------------------------------" echo "For more info about the license: https://www.elastic.co/subscriptions" echo echo "Updating the license..." $docker elasticsearch >/dev/null 2>&amp;1 result=\$(curl -s -X POST "\${ES_LOCAL_URL}/_license/start_basic?acknowledge=true" -H "Authorization: ApiKey \${ES_LOCAL_API_KEY}" -o /dev/null -w '%{http_code}\n') if [ "\$result" = "200" ]; then echo "âœ… Basic license successfully installed" echo "ES_LOCAL_LICENSE=basic" >> .env else echo "Error: I cannot update the license" result=\$(curl -s -X GET "\${ES_LOCAL_URL}" -H "Authorization: ApiKey \${ES_LOCAL_API_KEY}" -o /dev/null -w '%{http_code}\n') if [ "\$result" != "200" ]; then echo "Elasticsearch is not running." fi exit 1 fi echo fi $docker EOM if [ "$need_wait_for_kibana" = true ]; then cat >> start.sh &lt;&lt;-'EOM' wait_for_kibana 120 EOM fi chmod +x start.sh } # Create the stop script (stop.sh) create_stop_file() { cat > stop.sh &lt;&lt;-'EOM' #!/bin/sh # Stop script for start-local # More information: https://github.com/elastic/start-local set -eu SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)" cd "${SCRIPT_DIR}" EOM cat >> stop.sh &lt;&lt;- EOM $docker_stop EOM chmod +x stop.sh } # Create the uninstall script (uninstall.sh) create_uninstall_file() { cat > uninstall.sh &lt;&lt;-'EOM' #!/bin/sh # Uninstall script for start-local # More information: https://github.com/elastic/start-local set -eu SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)" ask_confirmation() { echo "Do you confirm? (yes/no)" read -r answer case "$answer" in yes|y|Y|Yes|YES) return 0 # true ;; no|n|N|No|NO) return 1 # false ;; *) echo "Please answer yes or no." ask_confirmation # Ask again if the input is invalid ;; esac } cd "${SCRIPT_DIR}" if [ ! -e "docker-compose.yml" ]; then echo "Error: I cannot find the docker-compose.yml file" echo "I cannot uninstall start-local." fi if [ ! -e ".env" ]; then echo "Error: I cannot find the .env file" echo "I cannot uninstall start-local." fi echo "This script will uninstall start-local." echo "All data will be deleted and cannot be recovered." if ask_confirmation; then EOM cat >> uninstall.sh &lt;&lt;- EOM $docker_clean $docker_remove_volumes rm docker-compose.yml .env uninstall.sh start.sh stop.sh config/telemetry.yml if [ -z "\$(ls -A config)" ]; then rm -d config fi echo echo "Do you want to remove the following Docker images?" echo "- docker.elastic.co/elasticsearch/elasticsearch:${es_version}" EOM if [ -z "${esonly:-}" ]; then cat >> uninstall.sh &lt;&lt;- EOM echo "- docker.elastic.co/kibana/kibana:${es_version}" EOM fi cat >> uninstall.sh &lt;&lt;- EOM if ask_confirmation; then if docker rmi "docker.elastic.co/elasticsearch/elasticsearch:${es_version}" >/dev/null 2>&amp;1; then echo "Image docker.elastic.co/elasticsearch/elasticsearch:${es_version} removed successfully" else echo "Failed to remove image docker.elastic.co/elasticsearch/elasticsearch:${es_version}. It might be in use." fi EOM if [ -z "${esonly:-}" ]; then cat >> uninstall.sh &lt;&lt;- EOM if docker rmi docker.elastic.co/kibana/kibana:${es_version} >/dev/null 2>&amp;1; then echo "Image docker.elastic.co/kibana/kibana:${es_version} removed successfully" else echo "Failed to remove image docker.elastic.co/kibana/kibana:${es_version}. It might be in use." fi EOM fi cat >> uninstall.sh &lt;&lt;- EOM fi echo "Start-local successfully removed" fi EOM chmod +x uninstall.sh } create_docker_compose_file() { # Create the docker-compose-yml file cat > docker-compose.yml &lt;&lt;-'EOM' services: elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch:${ES_LOCAL_VERSION} container_name: ${ES_LOCAL_CONTAINER_NAME} volumes: - dev-elasticsearch:/usr/share/elasticsearch/data ports: - 127.0.0.1:${ES_LOCAL_PORT}:9200 environment: - discovery.type=single-node - ELASTIC_PASSWORD=${ES_LOCAL_PASSWORD} - xpack.security.enabled=true - xpack.security.http.ssl.enabled=false - xpack.license.self_generated.type=trial - xpack.ml.use_auto_machine_memory_percent=true - ES_JAVA_OPTS=-Xms${ES_LOCAL_HEAP_INIT} -Xmx${ES_LOCAL_HEAP_MAX} - cluster.routing.allocation.disk.watermark.low=${ES_LOCAL_DISK_SPACE_REQUIRED} - cluster.routing.allocation.disk.watermark.high=${ES_LOCAL_DISK_SPACE_REQUIRED} - cluster.routing.allocation.disk.watermark.flood_stage=${ES_LOCAL_DISK_SPACE_REQUIRED} EOM # Fix for JDK AArch64 issue, see https://bugs.openjdk.org/browse/JDK-8345296 if is_arm64; then cat >> docker-compose.yml &lt;&lt;-'EOM' - "_JAVA_OPTIONS=-XX:UseSVE=0" EOM fi # Fix for OCI issue on LXC, see https://github.com/elastic/start-local/issues/27 if ! detect_lxc; then cat >> docker-compose.yml &lt;&lt;-'EOM' ulimits: memlock: soft: -1 hard: -1 EOM fi cat >> docker-compose.yml &lt;&lt;-'EOM' healthcheck: test: [ "CMD-SHELL", "curl --output /dev/null --silent --head --fail -u elastic:${ES_LOCAL_PASSWORD} http://elasticsearch:9200", ] interval: 10s timeout: 10s retries: 30 EOM if [ -z "${esonly:-}" ]; then cat >> docker-compose.yml &lt;&lt;-'EOM' kibana_settings: depends_on: elasticsearch: condition: service_healthy image: docker.elastic.co/elasticsearch/elasticsearch:${ES_LOCAL_VERSION} container_name: ${KIBANA_LOCAL_SETTINGS_CONTAINER_NAME} restart: 'no' command: > bash -c ' echo "Setup the kibana_system password"; start_time=$$(date +%s); timeout=60; until curl -s -u "elastic:${ES_LOCAL_PASSWORD}" -X POST http://elasticsearch:9200/_security/user/kibana_system/_password -d "{\"password\":\"${KIBANA_LOCAL_PASSWORD}\"}" -H "Content-Type: application/json" | grep -q "^{}"; do if [ $$(($$(date +%s) - $$start_time)) -ge $$timeout ]; then echo "Error: Elasticsearch timeout"; exit 1; fi; sleep 2; done; ' kibana: depends_on: kibana_settings: condition: service_completed_successfully image: docker.elastic.co/kibana/kibana:${ES_LOCAL_VERSION} container_name: ${KIBANA_LOCAL_CONTAINER_NAME} volumes: - dev-kibana:/usr/share/kibana/data - ./config/telemetry.yml:/usr/share/kibana/config/telemetry.yml ports: - 127.0.0.1:${KIBANA_LOCAL_PORT}:5601 environment: - SERVER_NAME=kibana - ELASTICSEARCH_HOSTS=http://elasticsearch:9200 - ELASTICSEARCH_USERNAME=kibana_system - ELASTICSEARCH_PASSWORD=${KIBANA_LOCAL_PASSWORD} - XPACK_ENCRYPTEDSAVEDOBJECTS_ENCRYPTIONKEY=${KIBANA_ENCRYPTION_KEY} - ELASTICSEARCH_PUBLICBASEURL=http://localhost:${ES_LOCAL_PORT} healthcheck: test: [ "CMD-SHELL", "curl -s -I http://kibana:5601 | grep -q 'HTTP/1.1 302 Found'", ] interval: 10s timeout: 10s retries: 30 EOM fi cat >> docker-compose.yml &lt;&lt;-'EOM' volumes: dev-elasticsearch: EOM if [ -z "${esonly:-}" ]; then cat >> docker-compose.yml &lt;&lt;-'EOM' dev-kibana: EOM fi create_kibana_config } create_kibana_config() { if [ ! -d "config" ]; then mkdir config fi # Create telemetry cat > config/telemetry.yml &lt;&lt;- EOM start-local: version: ${version} EOM } print_steps() { if [ -z "${esonly:-}" ]; then echo "âŒ›ï¸ Setting up Elasticsearch and Kibana v${es_version}..." else echo "âŒ›ï¸ Setting up Elasticsearch v${es_version}..." fi echo echo "- Generated random passwords" echo "- Created the ${folder} folder containing the files:" echo " - .env, with settings" echo " - docker-compose.yml, for Docker services" echo " - start/stop/uninstall commands" } running_docker_compose() { # Execute docker compose echo "- Running ${docker}" echo set +e if ! $docker; then error_msg="Error: ${docker} command failed!" echo "$error_msg" if [ -z "${esonly:-}" ]; then generate_error_log "${error_msg}" "${elasticsearch_container_name} ${kibana_container_name} kibana_settings" else generate_error_log "${error_msg}" "${elasticsearch_container_name}" fi cleanup exit 1 fi set -e } api_key() { # Create an API key for Elasticsearch api_key=$(create_api_key "$es_password" "$api_key_name") if [ -n "$api_key" ]; then echo "ES_LOCAL_API_KEY=${api_key}" >> .env fi } kibana_wait() { if [ "$need_wait_for_kibana" = true ]; then wait_for_kibana 120 fi } success() { echo if [ -z "${esonly:-}" ]; then echo "ğŸ‰ Congrats, Elasticsearch and Kibana are installed and running in Docker!" echo echo "ğŸŒ Open your browser at http://localhost:5601" echo echo " Username: elastic" echo " Password: ${es_password}" echo else echo "ğŸ‰ Congrats, Elasticsearch is installed and running in Docker!" fi echo "ğŸ”Œ Elasticsearch API endpoint: http://localhost:9200" if [ -n "$api_key" ]; then echo "ğŸ”‘ API key: $api_key" echo else echo "ğŸ”‘ Use basic auth or create an API key" echo "https://www.elastic.co/guide/en/kibana/current/api-keys.html" echo fi echo echo "Learn more at https://github.com/elastic/start-local" echo } main() { parse_args "$@" startup check_requirements check_installation_folder check_docker_services create_installation_folder generate_passwords choose_es_version create_start_file create_stop_file create_uninstall_file create_env_file create_docker_compose_file print_steps running_docker_compose api_key kibana_wait success } ctrl_c() { cleanup exit 1 } # Trap ctrl-c trap ctrl_c INT # Execute the script main "$@"</p></div><footer class=entry-footer><span title='2025-07-30 20:06:04 +0800 CST'>July 30, 2025</span>&nbsp;Â·&nbsp;16 min&nbsp;Â·&nbsp;3213 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to Elasticsearch" href=https://heyuuuu77.github.io/posts/elasticsearch/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Tree</h2></header><div class=entry-content><p>å“ˆå¸Œå†²çªçš„åŸå› ä»¥åŠè§£å†³åŠæ³• hashç®—æ³•æ˜¯ä¸€ç§æ•°æ®å‹ç¼©æ–¹å¼ï¼Œç”±äºç®—æ³•äº§ç”Ÿçš„å“ˆå¸Œå€¼çš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥å½“æ•°æ®é‡å¤§æ—¶å°±ä¼šå‡ºç°å“ˆå¸Œå€¼ä¸å¤Ÿç”¨çš„æƒ…å†µï¼Œå¤šä¸ªæ•°æ®é€šè¿‡ç®—æ³•çš„å‡ºäº†ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚ä»è€Œäº§ç”Ÿäº†å†²çªã€‚</p></div><footer class=entry-footer><span title='2025-06-06 15:53:55 +0800 CST'>June 6, 2025</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;2 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to Tree" href=https://heyuuuu77.github.io/posts/tree/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>è®°å½•ä¸€æ¬¡curlçš„æŠ¥é”™</h2></header><div class=entry-content><p>$client_id = env('baidu.api_key'); $client_secret = env('baidu.secret_key'); $token_url = 'https://aip.baidubce.com/oauth/2.0/token'; $curl = curl_init(); curl_setopt_array($curl, array( CURLOPT_URL => "{$token_url}?client_id={$client_id}&amp;client_secret={$client_secret}&amp;grant_type=client_credentials", CURLOPT_TIMEOUT => 30, CURLOPT_RETURNTRANSFER => true, CURLOPT_CUSTOMREQUEST => 'POST', CURLOPT_HTTPHEADER => array( 'Content-Type: application/json', 'Accept: application/json' ), )); $response = curl_exec($curl); curl_close($curl); $response = json_decode($response, 1); $response å§‹ç»ˆè¿”å› false, curl_error($curl) æ˜¾ç¤ºçš„æ˜¯ç©ºå­—ç¬¦ä¸² â€˜â€™, curl_errno($curl) æ˜¾ç¤ºçš„77. æ²¡æœ‰å…¶ä»–ä»»ä½•ä¿¡æ¯ã€‚ curl_getinfo($curl) æ˜¾ç¤ºçš„éƒ½æ˜¯æ— æ•ˆä¿¡æ¯ã€‚
æŸ¥è¯¢äº†å¾ˆå¤šï¼Œæœ‰çš„è¯´æ˜¯ sslè¯ä¹¦ caæ–‡ä»¶æŸåç­‰ã€‚ æœ€ç»ˆè§£å†³æ–¹å¼æ˜¯é‡å¯ php-fpm æœåŠ¡ã€‚ sudo systemctl restart php-fpm å°±å¯ä»¥äº†ã€‚</p></div><footer class=entry-footer><span title='2025-06-03 14:43:01 +0800 CST'>June 3, 2025</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;65 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to è®°å½•ä¸€æ¬¡curlçš„æŠ¥é”™" href=https://heyuuuu77.github.io/posts/curl/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Advertiser</h2></header><div class=entry-content><p>å¹¿å‘Šçš„è®¡è´¹æ¨¡å¼æœ‰å“ªå‡ ç§ CPM (Cost Per Mile)åƒæ¬¡å±•ç¤ºè®¡è´¹ CPC (Cost Per Click) ç‚¹å‡»æ”¶è´¹ CPA (Cost Per Action) è¡ŒåŠ¨æ”¶è´¹ å¹¿å‘Šä¸»åœ¨ç”¨æˆ·å®ŒæˆæŸä¸ªç‰¹å®šè¡Œä¸ºæ‰ä¼šæ”¯ä»˜è´¹ç”¨ CTP (Cost Per Time) æŒ‰æ—¶é•¿æ”¶è´¹ CPI (Cost Per Install) æŒ‰å®‰è£…æ”¶è´¹ç­‰ ç°ä»£å¹¿å‘Šç³»ç»Ÿæ¶æ„ å¹¿å‘ŠæŠ•æ”¾å¹³å°ï¼ˆDSP, Demand-Side Platformï¼‰ å¹¿å‘Šä¸»é€šè¿‡DSPè¿›è¡ŒæŠ•æ”¾ï¼ŒDSPè´Ÿè´£ç«ä»·ï¼Œå®šå‘ï¼Œä¼˜åŒ–ç­‰åŠŸèƒ½
ä¾›åº”æ–¹å¹³å°ï¼ˆSSP, Supply-Side Platformï¼‰ åª’ä½“æ–¹é€šè¿‡SSPç®¡ç†å¹¿å‘Šåº“å­˜ï¼Œå¹¿å‘Šåº“å­˜å°±æ˜¯å¹¿å‘Šä½ã€‚å¦‚æœè‡ªå·±å¼€å‘ä¸€ä¸ªappï¼Œæƒ³æ¥å¹¿å‘Šã€‚ä¸éœ€è¦è‡ªå·±æ‰¾å¹¿å‘Šä¸»ï¼Œç›´æ¥æŠŠå¹¿å‘Šä½å–ç»™SSPå°±è¡Œ
å¹¿å‘Šäº¤æ˜“å¸‚åœº(Ad Exchange), ä¸€ä¸ªå¼€å‘çš„å¹¿å‘Šç«ä»·å¹³å°ï¼Œé“¾æ¥DSPå’ŒSSPã€‚
æ•°æ®ç®¡ç†å¹³å°(DMP, Data Managerment Platform), æ”¶é›†ï¼Œåˆ†æç”¨æˆ·æ•°æ®ï¼Œæé«˜å¹¿å‘Šå®šå‘èƒ½åŠ›ç­‰
å¹¿å‘Šç›‘æµ‹å¹³å°(Ad Monitor), ç›‘æµ‹å¹¿å‘ŠæŠ•æ”¾æ•ˆæœï¼Œæ¯”å¦‚å¹¿å‘ŠæŠ•æ”¾çš„æ›å…‰é‡ï¼Œç‚¹å‡»é‡ï¼Œè½¬åŒ–ç­‰ï¼Œå½’å› åˆ†æã€‚</p></div><footer class=entry-footer><span title='2025-04-14 09:53:08 +0800 CST'>April 14, 2025</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;46 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to Advertiser" href=https://heyuuuu77.github.io/posts/advertiser/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://heyuuuu77.github.io/posts/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://heyuuuu77.github.io/>heyuuuu77</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>